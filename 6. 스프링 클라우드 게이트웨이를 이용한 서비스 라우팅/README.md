# 스프링 클라우드 게이트웨이를 이용한 서비스 라우팅
- 마이크로서비스와 같은 분산형 아키텍처에서는 보안과 로깅, 여러 서비스 호출에 걸친 사용자 추적처럼 중요한 작업을 해야 할 시점이 온다. 이 기능을 구현하려고 모든 개발 팀이 독자적인 솔루션을 구축할 필요 없이 이러한 특성을 모든 서비스에 일관되게 적용하길 원할 것이다. 공통 라이브러리나 프레임워크를 사용해서 이들 기능을 각 서비스에 직접 구축할 수도 있지만, 이 방법은 다음과 같은 결과를 초래할 수 있다.
    - **이러한 기능을 각 서비스에 일관되게 구현하기 어렵다**: 개발자는 제품 기능을 제공하는 데 매달리고 정신없이 바쁜 일상에 쫓겨 서비스 로깅이나 추적 기능이 요구되는 규제 산업에서 일하지 않는다면 이러한 기능 구현을 잊어버리기 쉽다.
    - **보안과 로깅 같은 횡단 관심사(cross-cutting concerns)의 구현 책임을 개별 개발 팀에 전가하면 잘못 구현하거나 아예 누락할 수 있다**: 횡단 관심사는 애플리케이션 전체에 적용할 수 있고, 애플리케이션의 다른 부분에 영향을 줄 수 있는 프로그램 설계 일부나 기능을 나타낸다.
    - **모든 서비스에 걸쳐 강한 의존성을 만들 수 있다**: 모든 서비스에 공유되는 공통 프레임워크에 더 많은 기능을 추가할수록 서비스 재컴파일과 재배포 없이 공통 코드의 동작 변경이나 추가는 더욱 어려워진다. 갑작스런 공유 라이브러리에 내장된 핵심 기능 업그레이드는 장기적인 이전 작업이 된다.
- 이 문제를 해결하려면 **횡단 관심사를 독립적으로 배치할 수 있고, 아키텍처의 모든 마이크로서비스 호출에 대한 필터와 라우터 역할을 할 수 있는 서비스로 추상화**해야 한다. 이러한 서비스를 <code>게이트웨이(gateway)</code>라고 한다. 서비스 클라이언트는 더 이상 마이크로서비스를 직접 호출하지 않는다. 그 대신 모든 호출은 단일 정책 시행 지점(PEP, Policy Enforcement Point) 역할을 하는 서비스 게이트웨이를 경유한 다음 최종 목적지로 라우팅된다.
- 구체적으로 살펴볼 스프링 클라우드 게이트웨이 사용 방법은 다음과 같다.
    - 하나의 URL 뒤에 모든 서비스를 배치하고 서비스 디스커버리(service discovery)를 사용하여 해당 호출을 실제 서비스 인스턴스에 매핑하는 방법
    - 서비스 게이트웨이를 경유하는 모든 서비스 호출에 상관관계 ID를 삽입하는 방법
    - HTTP 응답에 전달받은 상관관계 ID를 삽입하여 클라이언트로 재전송하는 방법

## 서비스 게이트웨이란?
- 지금까지 이전 장에서 구축한 마이크로서비스를 사용하여 웹 클라이언트로 개별 서비스를 직접 호출하거나 유레카 등 서비스 디스커버리 엔진을 사용하여 프로그램 방식으로 호출했다.

---

## 스프링 클라우드 게이트웨이 소개

---

## 스프링 클라우드 게이트웨이에서 라우팅 구성 

---

## 스프링 클라우드 게이트웨이의 진정한 능력: Predicate와 Filter Factories

---

## 사전 필터 만들기

---

## 서비스에서 상관관계 ID 사용

---

## 상관관계 ID를 수신하는 사후 필터 작성 

