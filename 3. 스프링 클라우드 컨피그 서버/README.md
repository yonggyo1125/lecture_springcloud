> 소프트웨어 개발자는 애플리케이션 구성 정보(configuration)와 코드를 분리하는 것이 중요하다는 말을 항상 듣는다. 대부분 이 말은 코드에서 하드코딩된 값을 사용하지 않는 것을 의미한다. 이 원칙을 무시하면 구성 정보가 변경될 때마다 애플리케이션을 재컴파일하고 재배포해야 하므로 애플리케이션이 더 복잡해진다.
> 
> 애플리케이션 코드에서 구성 정보를 완전히 분리하면 개발자와 운영자가 재컴파일 과정을 거치지 않고 구성 정보를 변경할 수 있다. 하지만 개발자에게는 애플리케이션과 함께 관리하고 배포해야 할 또 다른 산출물이 생겨 복잡함도 가중된다.
> 
> 많은 개발자가 프로퍼티 파일(YAML, JSON, XML)을 사용해서 구성 정보를 저장한다. 이러한 파일 안에 애플리케이션 구성을 설정하는 것은 간단한 작업이므로 대부분의 개발자는 구성 파일을 소스 제어(있다면)에 추가하고 애플리케이션의 한 부분으로 배포하는 것 이상을 하지 않는다. 애플리케이션 수가 적은 경우 효과가 있지만 수백 개의 마이크로서비스가 많은 인스턴스를 실행하고 있는 클라우드 기반의 애플리케이션을 처리하고 있다면 이 방식은 문제가 된다. 갑자기 쉽고 간단한 프로세스가 중차대한 문제로 급부상해서 전체 팀은 전체 구성 파일과 씨름해야 한다.
> 
> 예를 들어 수백 개의 마이크로서비스가 있고 각 마이크로서비스에는 세 가지 환경에 대해 서로 다른 환경 구성이 포함되어 있다고 가정해 보자. 이 파일을 외부에서 관리하지 않는다면 변경 사항이 있을 때마다 코드 저장소에서 파일을 검색하고, 코드 저장소에서 검색해서 통합 과정(있다면)을 따라 애플리케이션을 재시작해야 한다. 이러한 재앙적인 상황을 피하려면 클라우드 기반 마이크로서비스 개발을 위한 모범 사례로 다음 사항을 고려해야 한다.

- 배포되는 실제 코드와 구성 정보를 완전히 분리한다.
- 여러 환경에서도 절대 변경되지 않는 불변(immutable) 애플리케이션 이미지를 빌드한다.
- 서버가 시작할 때 마이크로서비스가 읽어 오는 환경 변수 또는 중앙 저장소를 통해 모든 애플리케이션 구성 정보를 주입한다.

# 구성과 복잡성 관리

> 클라우드에서 실행하는 마이크로서비스에서는 마이크로서비스의 인스턴스가 사람의 개입을 최소화하여 신속하게 시작되어야 하므로 애플리케이션 구성을 관리하는 것은 중요하다. 사람이 서비스를 배포하기 위해 수동으로 구성하거나 건드려야 한다면 애플리케이션에서 구성 불일치(configuration drift)나 예기치 않은 장애, 확장 문제 대응을 위한 지연 시간 등이 발생할 수 있다.

## 구성관리 4가지 원칙 

- **분리(segregate)**: 서비스의 물리적 배포에서 서비스 구성 정보를 완전히 분리해야 한다. 실제로 애플리케이션 구성 정보는 서비스 인스턴스와 함께 배포되어서는 안 되며, 시작 중인 서비스에 환경 변수로 전달되거나 서비스가 시작할 때 중앙 저장소에서 읽어 들여야 한다.
- **추상화(abstract)**: 서비스 인터페이스 뒷단에 있는 구성 데이터의 접근 방식을 추상화해야 한다. 애플리케이션 구성 데이터를 조회하는 데 서비스 저장소(파일 기반 또는 JDBC 데이터베이스 기반)에서 직접 읽어 오는 코드를 작성하기보다 REST 기반 JSON 서비스를 사용해야 한다.
- **중앙 집중화(centralize)**: 클라우드 기반의 애플리케이션에는 실제로 수백 개의 서비스가 실행될 수 있어 구성 데이터를 보관하는 데 사용되는 여러 저장소 수를 최소화하는 것이 중요하다. 가능한 적은 수의 저장소로 애플리케이션 구성 정보를 모아야 한다.
- **견고화(harden)**: 애플리케이션 구성 정보는 배포되는 서비스와 완전히 분리되고 중앙 집중화되므로 사용하고 구현할 솔루션은 가용성이 높고 이중화가 필요하다.

## 구성 관리 아키텍처




# 스프링 클라우드 컨피그 서버 구축
# 스프링 클라우드 컨피그와 스프링 부트 클라이언트 통합
# 중요한 구성정보 보호 